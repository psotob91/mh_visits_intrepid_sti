"0","sti_effect_ploter <- function(model, alfa = 0.1, "
"0","                              color_point = ""#002D72"", "
"0","                              color_line = ""#002D72"", "
"0","                              color_interrupt = ""#99B933"", "
"0","                              mindate = ""2018-01-01"", "
"0","                              maxdate = ""2022-01-01"") {"
"0","  "
"0","  mindate <- as.Date(mindate) "
"0","  maxdate <- as.Date(maxdate)"
"0","  "
"0","  int_time <- mean(mod_full$bd.plot$tpand)"
"0","  "
"0","  int <- mod_full$bd.plot |> "
"0","    filter(time == int_time, To == 1) |> "
"0","    pull(date)"
"0","  "
"0","  mod_full$bd.plot |> "
"0","    mutate("
"0","      rate_fact = case_when("
"0","        To == 0 & time <= int_time ~ ratepred_t, "
"0","        To == 1 ~ ratepred_t,"
"0","        TRUE ~ as.numeric(NA)"
"0","        ), "
"0","      rate_ctf = case_when("
"0","        To == 0 & time >= int_time ~ ratepred_t, "
"0","        TRUE ~ as.numeric(NA)"
"0","      ),  "
"0","      rate_fact_s = case_when("
"0","        To == 0 & time <= int_time ~ ratepred_s, "
"0","        To == 1 ~ ratepred_s,"
"0","        TRUE ~ as.numeric(NA)"
"0","        ), "
"0","      rate_ctf_s = case_when("
"0","        To == 0 & time >= int_time ~ ratepred_s, "
"0","        TRUE ~ as.numeric(NA)"
"0","      )"
"0","      ) |> "
"0","    arrange(To, time) |> "
"0","    fill(rate_fact_s, .direction = ""up"") |> "
"0","    fill(rate_ctf_s, .direction = ""down"") |> "
"0","    mutate(dif_rate = if_else(rate_ctf_s < rate_fact_s,"
"0","                              ""Excess of visits"", "
"0","                              ""Deficit of visits"")) |> "
"0","    ggplot() + "
"0","    geom_point(aes(x = date, y = rateobs * 1000), "
"0","               fill = color_point, "
"0","               color = color_point) + "
"0","    geom_line(aes(x = date, "
"0","                  y = ratepred_s * 1000, "
"0","                  group = To), "
"0","              color = color_line, "
"0","              alpha = alfa) + "
"0","    geom_line(aes(x = date, "
"0","                  y = rate_fact * 1000, "
"0","                  group = To), "
"0","              color = color_line) + "
"0","    geom_line(aes(x = date, "
"0","                  y = rate_ctf * 1000, "
"0","                  group = To), "
"0","              color = color_line, "
"0","              linetype = ""dashed"") + "
"0","    geom_vline(xintercept = int, "
"0","               linetype = ""dashed"", "
"0","               color = color_interrupt) + "
"0","    geom_ribbon(aes(x = date, "
"0","                    ymin = rate_fact_s, "
"0","                    ymax = rate_ctf_s,"
"0","                    fill = dif_rate),"
"0","                alpha = 0.5) +"
"0","    scale_x_date(limits = c(mindate, maxdate), "
"0","                 breaks = ""1 year"", "
"0","                 expand = expansion(mult = c(0.01, 0.01)),"
"0","                 labels = date_format(""%Y""), "
"0","                 date_minor_breaks = ""6 month"") + "
"0","    theme_classic() + "
"0","    labs(y = ""Incidence Rates \n (numbers per 1000 habitants)"", "
"0","         x = ""Time"", "
"0","         title = countryc[i]) + "
"0","    theme(plot.title = element_text(hjust = 0.5)) -> plot"
"0","  "
"0","  return(plot)"
"0","}"
"0",""
