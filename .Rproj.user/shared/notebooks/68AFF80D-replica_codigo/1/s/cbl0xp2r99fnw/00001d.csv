"0",""
"0","# It is also useful to produce summary statistics"
"0","summary(data)"
"1",""
"1","      year     "
"1","     month       "
"1","      aces       "
"1","      time     "
"1","    smokban      "
"1","
"
"1"," Min.   :2002  "
"1"," Min.   : 1.000  "
"1"," Min.   : 659.0  "
"1"," Min.   : 1.0  "
"1"," Min.   :0.0000  "
"1","
"
"1"," 1st Qu.:2003  "
"1"," 1st Qu.: 3.500  "
"1"," 1st Qu.: 766.5  "
"1"," 1st Qu.:15.5  "
"1"," 1st Qu.:0.0000  "
"1","
"
"1"," Median :2004  "
"1"," Median : 6.000  "
"1"," Median : 831.0  "
"1"," Median :30.0  "
"1"," Median :0.0000  "
"1","
"
"1"," Mean   :2004  "
"1"," Mean   : 6.407  "
"1"," Mean   : 829.1  "
"1"," Mean   :30.0  "
"1"," Mean   :0.3898  "
"1","
"
"1"," 3rd Qu.:2005  "
"1"," 3rd Qu.: 9.000  "
"1"," 3rd Qu.: 878.0  "
"1"," 3rd Qu.:44.5  "
"1"," 3rd Qu.:1.0000  "
"1","
"
"1"," Max.   :2006  "
"1"," Max.   :12.000  "
"1"," Max.   :1021.0  "
"1"," Max.   :59.0  "
"1"," Max.   :1.0000  "
"1","
"
"1",""
"1","      pop        "
"1","     stdpop      "
"1","      rate      "
"1","
"
"1"," Min.   :363351  "
"1"," Min.   :374113  "
"1"," Min.   :175.0  "
"1","
"
"1"," 1st Qu.:363833  "
"1"," 1st Qu.:379437  "
"1"," 1st Qu.:201.4  "
"1","
"
"1"," Median :364277  "
"1"," Median :383428  "
"1"," Median :215.4  "
"1","
"
"1"," Mean   :364121  "
"1"," Mean   :383464  "
"1"," Mean   :216.1  "
"1","
"
"1"," 3rd Qu.:364421  "
"1"," 3rd Qu.:387335  "
"1"," 3rd Qu.:227.7  "
"1","
"
"1"," Max.   :364700  "
"1"," Max.   :394006  "
"1"," Max.   :260.7  "
"1","
"
"0","#tabulate aces before and after the smoking ban"
"0","summary(data$aces[data$smokban==0])"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","
"
"1","  659.0 "
"1","  759.2 "
"1","  811.0 "
"1","  810.9 "
"1","  858.5 "
"1","  937.0 "
"1","
"
"0","summary(data$aces[data$smokban==1])"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","
"
"1","  738.0 "
"1","  815.0 "
"1","  843.0 "
"1","  857.5 "
"1","  898.0 "
"1"," 1021.0 "
"1","
"
"0","summary(data$rate[data$smokban==0])"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","
"
"1","  175.0 "
"1","  200.5 "
"1","  213.1 "
"1","  213.3 "
"1","  225.1 "
"1","  244.3 "
"1","
"
"0","summary(data$rate[data$smokban==1])"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","
"
"1","  190.9 "
"1","  209.6 "
"1","  217.9 "
"1","  220.5 "
"1","  231.0 "
"1","  260.7 "
"1","
"
"0","################################################################################"
"0","#Step 4: Poisson regression model"
"0","#######################################"
"0","# In step 2 (main paper) we chose a step change model and we also used a Poisson"
"0","#   model as we are using count data"
"0","# In order to do this we model the count data directly (rather than the rate"
"0","#   which doesn't follow a Poisson distribution), using the population (log"
"0","#   transformed) as an offset variable in order to transform back to rates"
"0",""
"0","#Poisson with the standardised population as an offset"
"0","model1 <- glm(aces ~ offset(log(stdpop)) + smokban + time, family=poisson, data)"
"0","summary(model1)"
"1","
Call:
"
"1",""
"1","glm(formula = aces ~ offset(log(stdpop)) + smokban + time, family = poisson, 
    data = data)"
"1",""
"1","
"
"1","
Coefficients:
"
"1","           "
"1","   Estimate"
"1"," Std. Error"
"1","  z value"
"1"," Pr(>|z|)"
"1","    "
"1","
(Intercept)"
"1"," -6.2431509"
"1","  0.0111894"
"1"," -557.955"
"1","  < 2e-16"
"1"," ***"
"1","
smokban    "
"1"," -0.1116284"
"1","  0.0172248"
"1","   -6.481"
"1"," 9.13e-11"
"1"," ***"
"1","
time       "
"1","  0.0049450"
"1","  0.0004992"
"1","    9.905"
"1","  < 2e-16"
"1"," ***"
"1","
"
"1","---
Signif. codes:  "
"1",""
"1","0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1"
"1","
"
"1","
(Dispersion parameter for "
"1",""
"1","poisson"
"1",""
"1"," family taken to be "
"1",""
"1","1"
"1",""
"1",")

"
"1",""
"1","    Null deviance: 308.52  on 58  degrees of freedom
"
"1",""
"1","Residual deviance: 197.31  on 56  degrees of freedom
"
"1","AIC: "
"1",""
"1","708.03"
"1",""
"1","

"
"1",""
"1","Number of Fisher Scoring iterations: "
"1",""
"1","3"
"1",""
"1","
"
"1","
"
"0","summary(model1)$dispersion"
"1","[1]"
"1"," 1"
"1","
"
"0","round(ci.lin(model1,Exp=T),3)"
"1","           "
"1"," Estimate"
"1"," StdErr"
"1","        z"
"1"," P"
"1"," exp(Est.)"
"1","  2.5%"
"1"," 97.5%"
"1","
(Intercept)"
"1","   -6.243"
"1","  0.011"
"1"," -557.955"
"1"," 0"
"1","     0.002"
"1"," 0.002"
"1"," 0.002"
"1","
smokban    "
"1","   -0.112"
"1","  0.017"
"1","   -6.481"
"1"," 0"
"1","     0.894"
"1"," 0.865"
"1"," 0.925"
"1","
time       "
"1","    0.005"
"1","  0.000"
"1","    9.905"
"1"," 0"
"1","     1.005"
"1"," 1.004"
"1"," 1.006"
"1","
"
"0","# create a new dataframe with 0.1 time units to improve the graph"
"0","datanew <- data.frame(stdpop=mean(data$stdpop),smokban=rep(c(0,1),c(360,240)),"
"0","  time= 1:600/10,month=rep(1:120/10,5))"
"0",""
"0","# We generate predicted values based on the model in order to create a plot"
"0","pred1 <- predict(model1,type=""response"",datanew)/mean(data$stdpop)*10^5"
"0",""
"0","#This can then be plotted along with a scatter graph (see above)"
"0","plot(data$rate,type=""n"",ylim=c(0,300),xlab=""Year"",ylab=""Std rate x 10,000"","
"0","  bty=""l"",xaxt=""n"")"
